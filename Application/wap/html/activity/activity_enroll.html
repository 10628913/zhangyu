<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <link rel="stylesheet" type="text/css" href="../../css/aui-flex.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/aui.2.0.css" />
    <style>
        section{
           background-color: #fff;
           padding-top: 0.5rem;
           margin-bottom: 0.75rem;
        }
        .box{
            background-color: #fff;
            border-radius: 1rem;
            padding: 0.5rem 0.75rem;
        }
        .aui-flex-col{
            padding: 0.3rem 0;
        }
        .aui-flex-item-4{
            font-size: 0.7rem;
            color: #666;
        }
        h2.title {
            color: #d43d3d;
            /*border-left:2px solid #df3031;*/
            /*padding-left: 0.5rem;*/
            font-size: 0.7rem;
            margin: 0 0.75rem;
            margin-bottom: 0.5rem;
            box-sizing: border-box;
            display: box;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: justify;
            -webkit-justify-content: space-between;
                    justify-content: space-between;
        }
        .title-left {
            display: inherit;
            -webkit-align-items: center;
                    align-items: center;
        }
        h2.title i.aui-iconfont {
            font-size: 0.9rem !important;
            margin-right: 0.3rem;
        }
        h2.title .title-right .aui-iconfont {
            color: #999999;
        }
        .detail{
            padding: 0.5rem 0;
        }
        p{
            color: #999;
            font-size: 0.7rem;
        }
        .attention-info{
            padding:0.5rem 0.75rem;
        }
        .aui-bar{
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #df3031;
            color: #fff;
        }
        .conment-top{
            margin-top:2.3rem;
        }
        .btnbox{
            width: 100%;
            text-align: center;
            margin: 0.5rem 0;
        }
        .aui-btn{
            width: 90%;
            border-radius: 1.5rem;
            background-color: #df3031;
            color: #fff;

        }
    </style>
</head>
<body>
    <header class="aui-bar aui-bar-nav" id="header">
        <a class="aui-pull-left" tapmode onclick="closeWin()">
            <span class="aui-iconfont aui-icon-left"></span>
        </a>
        <div class="aui-title">报名</div>
    </header>
    <section >
        <h2 class="title">
            <div class="title-left ">
                <i class="aui-iconfont aui-icon-pencil"></i>填写信息
            </div>
        </h2>
        <div class="aui-line-x"></div>
        <div class="box">
            <div class="aui-flex-col aui-flex-middle">
                <div class="aui-flex-item-4 aui-text-left">姓名</div>
                <div class="aui-flex-item-8">
                    <input type="text" id="name" placeholder="请输入真实姓名" />
                </div>
            </div>
            <div class="aui-line-x"></div>
            <div class="aui-flex-col  aui-flex-middle">
                <div class="aui-flex-item-4 aui-text-left">联系电话</div>
                <div class="aui-flex-item-8">
                    <input type="text" id="mobile" placeholder="请输入联系电话" />
                </div>
            </div>
            <div class="aui-line-x"></div>
            <div class="aui-flex-col  aui-flex-middle">
                <div class="aui-flex-item-4 aui-text-left">报名人数</div>
                <div class="aui-flex-item-8">
                    <input type="number" id="count" placeholder="请输入报名人数" />
                </div>
            </div>
            <div class="aui-line-x"></div>
            <div class="btnbox" tapmode onclick="subApply()">
                <div class="aui-btn">提交报名</div>
            </div>
        </div>
    </section>

    <section class="attention">
        <h2 class="title">
            <div class="title-left">
                <i class="aui-iconfont aui-icon-info"></i>报名须知
            </div>
        </h2>
        <div class="aui-line-x"></div>
        <div class="attention-info">
            <!-- <p>1.
            <p>1）预订且出发日期均在活动期间，通过携程网包含1-2晚住宿的短途巴士游，短途自驾游，短途轮船产品（具体请见各产品的“特别优惠”信息），每2位成人预订可获赠1人出行金额的不限额旅游抵用券。</p>
            <p>2）一日游，不固定天数的产品，行程在4日以上的产品不参与送券。</p>
            <p>2.  本活动只适用于网上预订，非网上预订方式不可享受此活动。</p>
            <p>3.  本活动所赠送的旅游抵用券只限于使用在含交通和住宿的国内长途、海外产品以及邮轮产品（不包括任何长途或者海外的当地游产品）。</p>
            <p>4.  当地游产品、签证产品、租车产品等不在本活动抵用券的赠送和使用范围内。</p>
            <p>5.  赠送金额：根据成交订单中人均费用计算。（说明：若用户通过网上预订2成人出行，若每人消费120元，总计赠送120元不限额旅游抵用券。4成人出行，则总计赠送240元不限额旅游抵用券。若2成人，1儿童出行，总计费用360元，则赠送整个订单的人均消费，即120元不限额抵用券）</p>
            <p>6.  旅游抵用券将在用户回程后的第二个月15日前（10月份将于10月30日前）充入预订时的携程账户。</p>
            <p>7.  抵用券有效期：自充入日起6个月有效。</p>
            <p>8.  一卡代理、商旅客户不参加此活动。</p>
            <p>9. 在法律允许范围内，携程旅行网保留对本次活动的最终解释权。</p> -->
        </div>
    </section>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/aui-slide.js"></script>
<script type="text/javascript" src="../../script/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="../../script/jquery.getParam.js"></script>
<script type="text/javascript" src="../../script/layer.js"></script>
<script>
    var activity_id = $.getUrlParam("activity_id"),
    activity_type = $.getUrlParam("activity_type"),
    siteUrl="http://fangshi.apithink.com/index.php?s=";
    if($api.getStorage('mobile')){
        document.getElementById("mobile").value = $api.getStorage('mobile');
    }
    var a={};
	a.style = 'background-color:RGBA(0,0,0,0.6); color:#fff; border:none;';
	a.time = 2;
    getActivityNotice();
    function getActivityNotice(){
        $.ajax({
           type: "POST",
           url: siteUrl+'/App/Activity/getActivityNotice',
           success: function(ret){
               if(ret.code == 1){
                   document.querySelector(".attention-info").innerHTML = ret.data.content;
               }
           }
        });
    }

     function closeWin(){
        window.history.go(-1);
    }

    function subApply(){
        var token = $api.getStorage('token');
        var name = document.getElementById("name").value;
        var count = document.getElementById("count").value;
        var mobile = document.getElementById("mobile").value;
        var mobileRule = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
        if(!name){
            a.content = "请输入报名联系人姓名";
            layer.open(a);
            return;
        }
        if(!count){
            a.content = "请输入报名人数";
            layer.open(a);
            return;
        }
        if(!mobileRule.test(mobile)){
            a.content = "请输入正确的联系电话";
            layer.open(a);
            return;
        }
        var param = "token="+token+"&order_people_number="+count
            +"&order_contact_name="+name+"&order_contact_mobile="+mobile
            +"&activity_id="+activity_id+"&activity_type="+activity_type;
        $.ajax({
           type: "POST",
           url: siteUrl+'App/Activity/activityRegister',
           data: param,
           success: function(ret){
               a.content = ret.msg;
               layer.open(a);
               switch(ret.code){
                   case  1:
                       var el = document.querySelectorAll("input");
                       for(var i=0;i<el.length;i++){
                           el[i].value = "";
                       }
                       setTimeout(function(){
                           window.history.go(-1);
                       },1000)
                   break;
                   case  -1:
                   break;
                   case 0:
                       $api.rmStorage("userid");
                       $api.rmStorage("mobile");
                       $api.rmStorage("nickname");
                       $api.rmStorage("avatar");
                       $api.rmStorage("token");
                       setTimeout(function(){
                           window.history.go(-1);
                       },1000)
                   break;
               }
           }
        });
    }
</script>
</body>
</html>
