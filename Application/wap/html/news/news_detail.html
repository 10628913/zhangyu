<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <link rel="stylesheet" type="text/css" href="../../css/aui.2.0.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui-flex.css" />
    <link rel="stylesheet" type="text/css" href="../../css/layer.css" />
    <style>
        .aui-bar{
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #df3031;
            color: #fff;
        }
        .aui-bar +*{
            padding-top: 2.5rem !important;
        }
        html,body{
            background-color: #fff;
            overflow-x: hidden;
            overflow-y:auto;
        }
        h1 {
            font-size: 1.2rem;
        }
        .aui-content {
            background-color: #ffffff;
        }
        .news-info {
            margin-bottom: 0;
            padding: 0.5rem 0.75rem;
            overflow: hidden;
        }
        .news-desc {
            margin-top: 0.5rem;
            width: 100%;
            font-size: 0.6rem;
            color: #999999;
        }
        .news-info .aui-iconfont {
            font-size: 0.7rem;
        }
        .news-info time {
            margin-left: 0.5rem;
        }
        .news-info span {
            margin: 0 0.25rem;
        }
        .aui-list.user-info .aui-list-item-media img.aui-list-img-sm {
            width: 2rem;
            height: 2rem;
        }

        .aui-list.user-info .aui-list-item-media,
        .aui-list.user-info .aui-list-item-inner {
            padding: 0.3rem 0;
            padding-left: 0.75rem;
        }
        .aui-list-item-arrow:before {
            right: 0.75rem;
        }
        .aui-list.user-info .user-name {
            font-size: 0.7rem;
        }
        .aui-list.user-info .user-address {
            font-size: 0.6rem;
        }
        .news-content {
            font-size: 0.9rem;
            color: #333;
        }
        .news-content img {
            width: 100%;
        }
        .bar {
            border-bottom: 1px solid #d43d3d;
        }
        .bar .bar-item {
            margin-right: 0.25rem;
            padding: 0.15rem 0;
            color: #ffffff;
            box-sizing: border-box;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-align-items: center;
                    align-items: center;
            /*-webkit-box-pack: center;
            -webkit-justify-content: center;
            -ms-flex-pack: center;
                justify-content: center;*/
        }

        .bar .bar-item:last-child {
            line-height: 1.8rem;
            margin-right: 0;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
                justify-content: center;
        }
        .bar .bar-item:last-child .aui-iconfont {
            font-size: 0.7rem;
            margin-left: 0.5rem;
        }
        .bar .bar-item .aui-iconfont {
            color: #ffffff;
            font-size: 1rem;
        }
        .news-tag {
            box-sizing: border-box;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: justify;
            -webkit-align-items: center;
                    align-items: center;
        }
        .news-tag-item {
            padding: 0.2rem  0.75rem;
            font-size: 0.7rem;
            border: 1px solid #eee;
            background-color: #f8f8f8;
            border-radius: 0.2rem;
            margin: 0 0.125rem;
        }
        .news-tag-item.aui-tag-info {
            color: #666;
        }
        .aui-border.aui-tag-info:after {
            border:1px solid #5b9cf5;
            border-radius: 1.4rem;
        }
        .aui-content.relation {
            padding: 0.75rem 0 0 0;
        }
        h2.title {
            color: #df3031;
            border-left:2px solid #df3031;
            padding-left: 0.5rem;
            font-size: 0.7rem;
            margin: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .more {
            padding: 0.75rem 0;
            font-size: 0.6rem;
            text-align: center;
            color: #999;
        }
        .comment-list{
            margin-bottom: 2.4rem;
        }
        .comment-list .aui-list .aui-list-item-title {
            font-size: 0.7rem;
        }
        .comment-list .aui-list .aui-list-item-text {
            font-size: 0.6rem;
        }
        .comment-list .aui-list p {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: #333;
        }
        .comment-list .aui-iconfont {
            font-size: 0.8rem !important;
        }
        .up-top {
            width: 2rem;
            position: fixed;
            right: 0.75rem;
            bottom: 4rem;
            z-index: 998;
            opacity: 0.6;
            -webkit-transition-duration: 300ms;
                    transition-duration: 300ms;
        }
        .up-top img {
            width: 100%;
        }
        .up-top .aui-iconfont {
            color: #666;
        }
        .bg-light {
            background-color: #f4f4f4;
        }

        .reading {
            position: fixed;
            bottom: 0;
            left: 0;
            background: rgba(0,0,0,0.7);
            width: 100%;
            padding: 0.5rem 0.75rem;
            color: #ffffff;
            visibility: hidden;
        }
        .reading img {
            max-height: 2.3rem;
            display: block;
        }
        #language-box img {
            height: 1.5rem;
        }
        #language-box .aui-popover-content {
            border-radius: 0;
        }
        #language-box.border {
            border: 1px solid #df3031;
            border-top: none;
        }
        #language-box .aui-list {
            background: #f9f9f9;
            /*color: #ffffff !important;*/
        }
        .collection-success {
            position: fixed;
            left: 50%;
            top: 25%;
            width: 13rem;
            z-index: 999;
            margin-left: -7.5rem;
            opacity: 0;
            -webkit-transform: translate3d(0, -100%, 0) scale(1) rotate(-45deg);
                    transform: translate3d(0, -100%, 0) scale(1) rotate(-45deg);
            /*-webkit-transform:rotate(-45deg);*/
                    /*transform:rotate(-45deg);*/
        }
        .collection-success-in {
            opacity: 1;
             -webkit-transition-duration: 300ms;
                    transition-duration: 300ms;
            -webkit-transform: translate3d(0, 0, 0) scale(1);
                    transform: translate3d(0, 0, 0) scale(1);
        }
        .collection-success-out {
          opacity: 0;
          -webkit-transition-duration: 300ms;
                  transition-duration: 300ms;
          -webkit-transform: translate3d(0, 100%, 0) scale(0.5) rotate(45deg);
                  transform: translate3d(0, 100%, 0) scale(0.5) rotate(45deg);
        }
        .collection-success img {
            width: 100%;
        }


        /**/
        .comment-info{
            color: #666;
            font-size: 0.6rem;
            margin: 0.3rem 0;
        }
        .comment-info .aui-iconfont{
            font-size: 0.6rem !important;
        }
        .comment-content {
            background-color: #f2f2f2;
            display: block !important;
        }
        .comment-item{
            padding: 0.1rem 0.3rem;
            font-size: 0.7rem;
        }
        .comment-item span:first-child{
            color: #3492e9;
        }
        .comment-more{
            color: #3492e9;
            font-size: 0.7rem;
            text-decoration: underline;
            padding: 0.1rem 0.3rem;
            text-align: center;
        }

        /**/
        .footer-bar {
            width: 100%;
            background: #f4f5f7;
            position: fixed;
            bottom: 0;
            left: 0;
            height: 2.25rem;
            line-height: 2.25rem;
        }
        .footer-bar .aui-iconfont {
            color: #333;
            font-size: 1rem !important;
        }
        .footer-bar .input-bar {
            width: 90%;
            margin-top: 0.3rem;
            margin-left: 0.75rem;
            min-height: 1.6rem !important;
            height: 1.6rem;
            line-height: 1.6rem;
            font-size: 0.6rem;
            padding-left: 0.5rem;
            color: #bbb;
            overflow: hidden;
            border-radius: 1.5rem;
            border: 1px solid #eee;
            background: #ffffff;
        }
        /*.footer-bar .input-bar.aui-border:after {
            border-radius: 1.5rem;
        }*/
        .footer-bar .input-bar .aui-iconfont {
            color: #bbb;
            font-size: 0.6rem !important;
            line-height: 1.5rem;
            margin-right: 0.25rem;
        }
        .footer-bar .aui-iconfont {
            font-size: 1rem;
        }


        #collection-btn .aui-iconfont.end{
                color: #df3031 !important;
        }
       #goodclick-btn .aui-iconfont.end{
            color: #df3031 !important;
        }
        .comment-box {
            width: 100%;
            background: #fff;
            position: fixed;
            bottom: 0;
            left: 0;
            z-index: 999;
            padding: 0.75rem;
            margin-bottom: 0;
            opacity: 0;
            -webkit-transform: translate3d(0, 100%, 0) scale(1);
                    transform: translate3d(0, 100%, 0) scale(1);
            display: none;
        }
        .comment-box.comment-box-in {
            opacity: 1;
             -webkit-transition-duration: 300ms;
                    transition-duration: 300ms;
            -webkit-transform: translate3d(0, 0, 0) scale(1);
                    transform: translate3d(0, 0, 0) scale(1);
            display: block;
        }
        .comment-box.comment-box-out {
          opacity: 0;
          -webkit-transition-duration: 300ms;
                  transition-duration: 300ms;
          -webkit-transform: translate3d(0, 80%, 0) scale(1);
                  transform: translate3d(0, 80%, 0) scale(1);
        }
        .comment-nav {
            display: box;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: justify;
            -webkit-justify-content: space-between;
                    justify-content: space-between;
            -webkit-align-items: center;
                    align-items: center;
            margin-bottom: 0.5rem;
            color: #333;
        }
        .comment-nav .comment-btn {
            font-size: 0.8rem;
        }
        .comment-nav .comment-btn.disabled {
            color: #999;
        }
        .comment-nav .comment-title {
            font-size: 0.9rem;
        }
        .wrap {
            width: 100%;
        }
        textarea {
            width: 100%;
            background: #ffffff;
            border: 1px solid #dddddd;
        }




        /*share*/
        .share-box {
            background: #ffffff;
            padding: 0.75rem 0;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 999;
            opacity: 0;
            -webkit-transform: translate3d(0, 30%, 0) scale(1);
                    transform: translate3d(0, 30%, 0) scale(1);
            display: none;
        }
        .share-box.share-box-in {
            opacity: 1;
             -webkit-transition-duration: 300ms;
                    transition-duration: 300ms;
            -webkit-transform: translate3d(0, 0, 0) scale(1);
                    transform: translate3d(0, 0, 0) scale(1);
            display: block;
        }
        .share-box.share-box-out {
          opacity: 0;
          -webkit-transition-duration: 300ms;
                  transition-duration: 300ms;
          -webkit-transform: translate3d(0, 30%, 0) scale(1);
                  transform: translate3d(0, 30%, 0) scale(1);
        }
        .share-box p {
            font-size: 0.6rem;
            color: #666;
        }
        .share-box .aui-iconfont {
            font-size: 1.5rem;
            color: #333;
        }
        .share-box .share-inner {
            width: 100%;
            overflow: hidden;
        }
        .share-box .share-close {
            padding-top: 0.75rem;
            margin-top: 0.75rem;
        }
        .share-box .share-close .aui-iconfont {
            font-size: 1rem;
            color: #999;
            padding: 0.5rem;
            background-color: #f4f4f4;
            border-radius: 50%;
        }
        .share-inner img{
            width:40%;
        }
        .share-inner p{
            margin-bottom: 0.5rem;
        }
        .no-comment-data {
            width: 100%;
            text-align: center;
        }
        .no-comment-data img {
            width: 50%;
        }
        .news-detail-loading img {
            width: 50%;
        }
        #news-detail img{
            width: 100% !important;
        }
    </style>
</head>
<body>
    <header class="aui-bar aui-bar-nav" id="header">
        <a class="aui-pull-left" tapmode onclick="closeWin()">
            <span class="aui-iconfont aui-icon-left"></span>
        </a>
        <div class="aui-title">详情</div>
        <!-- <a class="aui-pull-right">
            <span class="aui-iconfont aui-icon-more"></span>
        </a> -->
    </header>

    <section id="news-detail" style="margin-bottom:0.75rem;width=100%;"></section>
    <section class="aui-content relation aui-hide">
    	<h2 class="title">相关推荐</h2>
    	<ul class="aui-list aui-media-list" id="news-relation-list">
        </ul>
        <div class="more" tapmode onclick="openRelation()">查看更多</div>
    </section>
    <section class="aui-content relation comment-list">
    	<h2 class="title">热门点评</h2>
    	<ul class="aui-list aui-media-list" id="news-comment-list">
            <div class="no-comment-data">
                <img src="../../image/no_comment_data.png" />
            </div>
        </ul>
    	<div class="more aui-hide" id="comment-more" tapmode onclick="openComment()"></div>
    </section>
    <div class="up-top" tapmode>
		<img src="../../image/uptop2.png" />
	</div>
    <div class="footer-bar aui-flex-col aui-border-t" id="footer">
        <div class="aui-flex-item-8" tapmode onclick="openCommentAdd()">
            <div class="input-bar">
                <i class="aui-iconfont aui-icon-pencil"></i>我要回复
            </div>
        </div>
        <div class="aui-flex-item-4 aui-text-center">
            <div class="aui-flex-item-6 aui-text-center" tapmode onclick="collection()" status="-1" id="collection-btn">
                <i class="aui-iconfont aui-icon-star"></i>
            </div>
            <div class="aui-flex-item-6  aui-text-center" tapmode onclick="goodClick()" status="-1" id="goodclick-btn">
                <i class="aui-iconfont aui-icon-laud"></i>
            </div>
            <!-- <div class="aui-flex-item-4 aui-text-center" tapmode onclick="openShare()">
                <i class="aui-iconfont aui-icon-share"></i>
            </div> -->
        </div>
    </div>
    <section class="comment-box" id="comment-box">
        <div class="comment-nav">
            <div class="comment-btn" tapmode onclick="closeAdd()">取消</div>
            <div class="comment-title">回复</div>
            <div class="comment-btn disabled" onclick="commentPost()">发送</div>
        </div>
        <div class="comment-wrap">
            <textarea class="aui-border comment-textarea" id="commentContent" rows="4"></textarea>
        </div>
    </section>
    <section class="share-box aui-text-center" id="share-box">
        <div class="share-inner">
            <div class="aui-col-xs-5">
                <img src="../../image/pengyouquan.png">
                <p>朋友圈</p>
            </div>
            <div class="aui-col-xs-5">
                <img src="../../image/weixin.png">
                <p>微信</p>
            </div>
            <div class="aui-col-xs-5">
                <img src="../../image/qq.png">
                <p>QQ</p>
            </div>
            <div class="aui-col-xs-5">
                <img src="../../image/kongjian.png">
                <p>QQ空间</p>
            </div>
            <div class="aui-col-xs-5">
                <img src="../../image/weibo.png">
                <p>微博</p>
            </div>
            <div class="aui-col-xs-5">
                <img src="../../image/duanxin.png">
                <p>短信分享</p>
            </div>
            <div class="aui-col-xs-5">
                <img src="../../image/shequ.png">
                <p>分享到社区</p>
            </div>
        </div>
        <div class="share-close aui-border-t">
            <i class="aui-iconfont aui-icon-close" tapmode onclick="closeShare()"></i>
        </div>
    </section>
</body>
<!-- 新闻详情 -->
<script id="news-detail-tpl" type="text/x-dot-template">
    <section class="aui-content news-info">
        <h1>{{=it.news_title}}</h1>
        <div class="news-desc">
            <div class="aui-pull-left">{{? it.news_source}}来源：{{=it.news_source}}{{?}}<time>{{=it.news_pub_time}}</time></div>
            <div class="aui-pull-right">
                <span><i class="aui-iconfont aui-icon-display"></i><span> {{=it.news_view_count}}</span></span>
                <span><i class="aui-iconfont aui-icon-comment"></i><span id="comment_count"> {{=it.news_comment_count}}</span></span>
            </div>
        </div>
    </section>
    {{? it.userid && it.userid > 0}}
    <section class="aui-list aui-media-list aui-list-noborder user-info">
        <div class="aui-list-item aui-list-item-arrow">
            <div class="aui-list-item-media">
                <img src="../../image/u1.png" class="aui-list-img-round aui-list-img-sm">
            </div>
            <div class="aui-list-item-inner">
                <div class="aui-list-item-title-row">
                    <div class="aui-list-item-title aui-text-info user-name">流浪的小猫咪</div>
                </div>
                <div class="aui-list-item-text user-address">北京 朝阳区</div>
            </div>
        </div>
    </section>
    {{?}}
    {{? it.news_content}}
    <section class="aui-content aui-padded-15 news-content" style="margin-bottom:0" id="content">
        {{=it.news_content.replace(/src="http/g,'src="../../image/image_loading_2.png" data-echo="http')}}
    </section>
    {{?}}
    {{? it.news_tags}}
    <section class="aui-content aui-padded-15 news-tag" style="padding-top:0">
        {{for(var i in it.news_tags){ }}
        <div class="news-tag-item aui-tag-info">{{=it.news_tags[i]}}</div>
        {{ } }}
    </section>
    {{?}}
</script>
<!-- 相关推荐 -->
<script id="news-relation-tpl" type="text/x-dot-template">
    {{ for(var i in it) { }}
    <li class="aui-list-item" tapmode onclick="openNewsDetail('{{=it[i].news_id}}',{{=it[i].type_id}})">
        {{? it[i].news_thumb}}
        <div class="aui-list-item-media">
            <img src="{{=it[i].news_thumb}}">
        </div>
        {{?}}
        <div class="aui-list-item-inner">
            <div class="aui-list-item-title">{{=it[i].news_title}}</div>
            <p style="margin-top:0.5rem;font-size:0.6rem;">
                {{=it[i].news_source}} {{=it[i].news_pub_time}}
            </p>
        </div>
    </li>
    {{ } }}
</script>
<!-- 评论列表 -->
<script id="news-comment-tpl" type="text/x-dot-template">
    {{ for(var i in it) { }}
    <li class="aui-list-item">
            {{? {{=it[i].avatar}}}}
            <div class="aui-list-item-media">
                <img  src="{{=it[i].avatar}}" class="aui-list-img-round aui-list-img-sm">
            </div>
            {{?}}
            <div class="aui-list-item-inner">
                <div class="aui-list-item-title-row">
                    <div class="aui-list-item-title aui-text-info">{{=it[i].nickname}}</div>
                    <div class="aui-list-item-right" tapmode onclick="commentLaud({{=it[i].comment_id}})">
                        <i class="aui-iconfont aui-icon-laud"></i> <span id="laud-count-{{=it[i].comment_id}}">{{=it[i].thumbs_count}}</span>
                    </div>
                </div>
                <div class="aui-list-item-text">{{? it[i].city}}{{=it[i].city}}{{?}} {{=it[i].comment_time}}</div>
                <p  tapmode onclick="openCommentDetail({{=it[i].comment_id}})">{{=it[i].comment_content}}</p>
                {{? it[i].child}}
                <div class="aui-list-item-text comment-info">
                    {{=it[i].childCount}}条回复
                    <span class="aui-iconfont aui-icon-right"></span>
                </div>
                {{ for (var ii in it[i].child){}}
                <div class="aui-list-item-text comment-content">
                    <div class="comment-item">
                        <span>{{=it[i].child[ii].nickname}}:</span>
                        <span>{{=it[i].child[ii].comment_content}}</span>
                    </div>
                </div>
                {{ } }}
                {{?}}
            </div>
        </li>
    {{ } }}
</script>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/layer.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript" src="../../script/echo.min.js"></script>
<script type="text/javascript" src="../../script/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="../../script/jquery.getParam.js"></script>
<script type="text/javascript">
    var siteUrl = "http://fangshi.apithink.com/index.php?s=";
    var news_id;
    var keywords;
    var classify_id,collectStatus=false,thumbsStatus=false;
    //提示框
    var a={};
	a.style = 'background-color:RGBA(0,0,0,0.6); color:#fff; border:none;';
	a.time = 2;

    $(document).ready(function(){
        news_id = $.getUrlParam('news_id');
        getNewsDetailData();
    });

    function openNewsDetail(news_id,type_id){
        switch (type_id) {
            case "1":
                var url = "news_detail.html?news_id="+news_id;
                break;
            case "2":
                var url = "news_album_detail.html?news_id="+news_id;
                break;
            case "3":
                var url = "news_video_detail.html?news_id="+news_id;
                break;
            case "4":
                var url = "news_detail.html?news_id="+news_id;
                break;
            default:
                var url = "news_detail.html?news_id="+news_id;
                break;
        }
        window.location.href = url;
    }
    // 获取新闻详情
    function getNewsDetailData(){
        document.getElementById("news-detail").style.height = window.innerHeight+"px";
        document.getElementById("news-detail").innerHTML = '<div class="news-detail-loading aui-text-center" style="line-height:'+ window.innerHeight+'px"><img src="../../image/loading.png" /></div>';
        var token = $api.getStorage("token");
        $.ajax({
           type: "POST",
           url: siteUrl+'App/News/getNewsDetail',
           data: "news_id="+news_id+"&token="+token,
           success: function(ret){
               if (ret) {
                   if(ret.code == '1'){
                       if(ret.data.collectStatus){
                        collectStatus = true;
                        document.querySelector('#collection-btn .aui-iconfont').classList.add("end");
                    }
                    if(ret.data.thumbsStatus){
                        thumbsStatus = true;
                        document.querySelector('#goodclick-btn .aui-iconfont').classList.add("end");
                    }
                       var tpl = document.getElementById("news-detail-tpl").innerHTML;
                       var tempFn = doT.template(tpl);
                       if(ret.data.news_tags){
                           ret.data.news_tags = ret.data.news_tags.split(",");
                       }
                       document.getElementById("news-detail").innerHTML = tempFn(ret.data);
                       document.getElementById("news-detail").style.height = 'auto';
                       classify_id = ret.data.classify_id;
                       // 获取相关推荐
                       getNewsRelation(ret.data.classify_id,""+ret.data.news_tags+"");
                       // 获取点评
                       getNewsComment(ret.data.news_id);
                       Echo.init({
                           offset: 0,
                           throttle: 250,
                           unload: false
                       });
                   }
               }
           }
        });
    }
    // 获取相关推荐
    function getNewsRelation(classify_id,tags){
        $.ajax({
           type: "POST",
           url: siteUrl+'App/News/getNewsRecommend',
           data: "news_id="+news_id+"&tags="+tags+"&pageNum=1&pageSize=3",
           success: function(ret){
               if(ret.code == '1'){
                   if(document.querySelector(".relation.aui-hide"))document.querySelector(".relation.aui-hide").classList.remove("aui-hide");
                   var tpl = document.getElementById("news-relation-tpl").innerHTML;
                   var tempFn = doT.template(tpl);
                   document.getElementById("news-relation-list").insertAdjacentHTML('beforeend', tempFn(ret.data));
               }
           }
        });
    }
    // 获取点评
    function getNewsComment(){
        $.ajax({
           type: "POST",
           url: siteUrl+'App/Comment/getCommentList',
           data: "news_id="+news_id+"&pageNum=1&pageSize=3",
           success: function(ret){
               if(ret.code == '1'){
                   var tpl = document.getElementById("news-comment-tpl").innerHTML;
                   var tempFn = doT.template(tpl);
                   document.getElementById("news-comment-list").innerHTML = tempFn(ret.data);
                   document.querySelector("#comment-more").classList.remove("aui-hide");
                   document.querySelector("#comment-more").textContent = "查看更多 ("+ret.commentCount+")";
               }
           }
        });
    }

    function collection(){
        var token = $api.getStorage('token');
        if(!token){
            openLogin();
            return;
        }
        if(collectStatus){
            delCollect();
        }else{
            addCollect();
        }
    }
    function addCollect(){
        var token = $api.getStorage('token');
        $.ajax({
           type: "POST",
           url: siteUrl+"App/Comment/newsCollect",
           data: "token="+token+"&news_id="+news_id,
           success: function(ret){
               if (ret) {
                   a.content = ret.msg;
                   layer.open(a);
                   if(ret.code == 1){
                       collectStatus = true;
                       document.querySelector('#collection-btn .aui-iconfont').classList.add("end");
                   }else{
                       collectStatus = false;
                       document.querySelector('#collection-btn .aui-iconfont').classList.remove("end");
                   }
               }
           }
        });
    }
     function delCollect(){
        var token = $api.getStorage('token');
        $.ajax({
           type: "POST",
           url: siteUrl+"App/Comment/delCollect",
           data: "token="+token+"&news_id="+news_id,
           success: function(ret){
               if (ret) {
                   a.content = ret.msg;
                   layer.open(a);
                   if(ret.code == 1){
                       collectStatus = false;
                       document.querySelector('#collection-btn .aui-iconfont').classList.remove("end");
                   }else{
                       collectStatus = true;
                       document.querySelector('#collection-btn .aui-iconfont').classList.add("end");
                   }
               }
           }
        });
    }
    function openLogin(){
        $api.setStorage("loginFrom","news/news_detail?news_id="+news_id);
        window.location.href="../login.html";
    }

    function goodClick(){
        var token = $api.getStorage('token');
        if(!token){
            openLogin();
            return;
        }
        thumbsUp();
    }
    function thumbsUp(){
        var token = $api.getStorage("token");
        $.ajax({
           type: "POST",
           url: siteUrl+"App/Comment/thumbsUp",
           data: "token="+token+"&item_id="+news_id,
           success: function(ret){
               if (ret) {
                   a.content = ret.msg;
                   layer.open(a);
                   if(ret.code == 1){
                       thumbsStatus = true;
                       document.querySelector('#goodclick-btn .aui-iconfont').classList.add("end");
                   }
                   if(ret.code == 2){
                       thumbsStatus = false;
                       document.querySelector('#goodclick-btn .aui-iconfont').classList.remove("end");
                   }
               }
           }
        });
    }

    // up top
    var upTopBtn = document.querySelector(".up-top");
    upTopBtn.onclick = function(){
        document.documentElement.scrollTop = document.body.scrollTop = 0;
        // document.documentElement.scrollTop=document.body.scrollTop=0;
    }
    //关闭分享页面
    function closeShare(){
        document.getElementById("share-box").classList.add("share-box-out");

        setTimeout(function(){
            document.getElementById("share-box").classList.remove("share-box-in");
        }, 300)
    }


    //关闭对话框
    function closeAdd(){
        document.getElementById("comment-box").classList.add("comment-box-out");

        setTimeout(function(){
            document.getElementById("comment-box").classList.remove("comment-box-in");
        }, 300)
    }
    //查看更多新闻推荐
    function openRelation(){
        window.location.href='news_relation.html?news_id='+news_id+"&keywords="+keywords;
    }
    //查看更多评论
    function openComment(){
        window.location.href='news_comment_all.html?news_id='+news_id;
    }
    //查看评论详情
    function openCommentDetail(comment_id){
        window.location.href='news_comment_all.html?news_id='+news_id+'&comment_id='+comment_id;
    }
    function openShare(){
        document.getElementById("share-box").classList.remove("share-box-out");
        document.getElementById("share-box").classList.add("share-box-in");
    }
    function openCommentAdd () {
        if(!$api.getStorage("token")){
            openLogin();
            return;
        }
        document.getElementById("comment-box").classList.remove("comment-box-out");
        document.getElementById("comment-box").classList.add("comment-box-in");
    }
    function readStop(){
        var speechRecognizer = api.require('speechRecognizer');
        speechRecognizer.stopRead();
        document.querySelector(".reading").style.visibility = "hidden";
        document.querySelector("img.pause").style.display = "none";
        document.querySelector("img.play").style.display = "block";
        document.querySelector(".up-top").style.bottom = "0.75rem";
    }
    function delHtmlTag(str){
        return str.replace(/<[^>]+>/g,"，");
    }
    // open language box
    var changeLanguageBtns = document.querySelectorAll('[data-type="changeLanguage"]');
    if(changeLanguageBtns.length){
        var languageBox = document.getElementById("language-box");
        for(var i in changeLanguageBtns){
            changeLanguageBtns[i].onclick = function(e){
                if(languageBox.style.visibility=="visible"){
                    languageBox.style.visibility = "hidden";
                    return;
                }
                // console.log(this.getBoundingClientRect().top+this.offsetHeight);
                if((this.getBoundingClientRect().top+this.offsetHeight) > 360){
                    // console.log(this.getBoundingClientRect());
                    // console.log(window.innerHeight);
                    languageBox.style.bottom = (window.innerHeight-this.getBoundingClientRect().bottom+this.offsetHeight)+"px";
                    languageBox.style.top = 'auto';
                    languageBox.style.width = this.offsetWidth+"px";
                    languageBox.style.visibility = "visible";
                    languageBox.classList.remove("border");
                }else{
                    languageBox.style.top = (this.getBoundingClientRect().top+this.offsetHeight)+"px";
                    languageBox.style.bottom = 'auto';
                    languageBox.style.width = this.offsetWidth+"px";
                    languageBox.style.visibility = "visible";
                    languageBox.classList.add("border");
                }

            }
        }
    }
    // change language
    var languageItems = document.querySelectorAll("#language-box li");
    if(languageItems.length){
        for( var i in languageItems){
            languageItems[i].onclick = function(e){
                readStop();
                var languageType = this.getAttribute("language-type");
                setTimeout(function(){
                    readNews(languageType);
                }, 300)
            }
        }
    }
    //评论提交
    function commentPost(){
        // if(status)return;
        var token = $api.getStorage('token');
        var comment_content = document.getElementById("commentContent").value;
        if(comment_content.length < 10) {
            a.content = "请输入10字以上评论内容";
            layer.open(a);
            return;
        }
        var values = "token="+token+"&news_id="+news_id+"&comment_content="+comment_content;
        $.ajax({
           type: "POST",
           url: siteUrl+'App/Comment/addComment',
           data: values,
           success: function(ret){
               if(ret) {
                   status = true;
                   a.content = ret.msg;
                   layer.open(a);
                   if(ret.code == 1){
                       document.getElementById("comment_count").textContent = ret.comment_count;
                       document.getElementById("commentContent").value = "";
                       getNewsComment();
                       setTimeout(function(){
                           closeAdd();
                       }, 1000)
                   }else if(ret.code==0){
                       setTimeout(function(){
                           openLogin();
                       }, 1000)
                       return;
                   }else{
                   }
               }
           }
        });
    }
    function goodclickBtn () {
        var goodclickBtn = document.getElementById('goodclick-btn');
        var goodclickli = goodclickBtn.querySelector('.aui-iconfont');
        var goodclickend = goodclickBtn.querySelector('.aui-iconfont.end');
        if (goodclickend){
            goodclickli.classList.remove('end');
        }else {
            goodclickli.classList.add('end');
        }
    }
    function collectionBtn () {
        var collectionBtn = document.getElementById('collection-btn');
        var collectionli = collectionBtn.querySelector('.aui-iconfont');
        var collectionend = collectionBtn.querySelector('.aui-iconfont.end');
        if (collectionend){
            collectionli.classList.remove('end');
        }else {
            collectionli.classList.add('end');
        }
    }

    // collection success
    function collectionSuccess(){
        if(!document.querySelector(".aui-mask")){
            var html = '<div id="alert">'+
                        '<div class="aui-mask">'+
                        '</div>'+
                        '<div class="collection-success">'+
                        '<img src="../../image/collection_success.png" />'+
                        '</div>'+
                        '</div>';
            document.querySelector("body").insertAdjacentHTML('beforeend', html);
            document.querySelector(".aui-mask").addEventListener("touchstart", function(){
                event.preventDefault();
            })
            document.querySelector(".collection-success").addEventListener("touchstart", function(){
                event.preventDefault();
            })
            setTimeout(function(){
                document.querySelector(".aui-mask").classList.add("mask-in");
                document.querySelector(".collection-success").classList.add("collection-success-in");
            }, 100)
            setTimeout(function(){
                document.querySelector(".aui-mask").classList.remove("mask-in");
                document.querySelector(".aui-mask").classList.add("mask-out");
                document.querySelector(".collection-success").classList.remove("collection-success-in");
                document.querySelector(".collection-success").classList.add("collection-success-out");
                setTimeout(function(){
                    document.getElementById("alert").parentNode.removeChild(document.getElementById("alert"));
                }, 300)
            }, 1600)
        }
    }
     function goodclickSuccess(){
        if(!document.querySelector(".aui-mask")){
            var html = '<div id="alert">'+
                        '<div class="aui-mask">'+
                        '</div>'+
                        '<div class="collection-success">'+
                        '<img src="../../image/zansuc.png" />'+
                        '</div>'+
                        '</div>';
            document.querySelector("body").insertAdjacentHTML('beforeend', html);
            document.querySelector(".aui-mask").addEventListener("touchstart", function(){
                event.preventDefault();
            })
            document.querySelector(".collection-success").addEventListener("touchstart", function(){
                event.preventDefault();
            })
            setTimeout(function(){
                document.querySelector(".aui-mask").classList.add("mask-in");
                document.querySelector(".collection-success").classList.add("collection-success-in");
            }, 100)
            setTimeout(function(){
                document.querySelector(".aui-mask").classList.remove("mask-in");
                document.querySelector(".aui-mask").classList.add("mask-out");
                document.querySelector(".collection-success").classList.remove("collection-success-in");
                document.querySelector(".collection-success").classList.add("collection-success-out");
                setTimeout(function(){
                    document.getElementById("alert").parentNode.removeChild(document.getElementById("alert"));
                }, 300)
            }, 1600)
        }
    }
    function closeWin(){
        window.history.go(-1);
    }


</script>
</html>
